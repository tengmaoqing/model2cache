/*!
 * Model2Cache.js v1.0.0
 * (c) 2019-2020 Teng Mao Qing
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Model2Cache=e()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function e(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var i=arguments[e],a=0,c=i.length;a<c;a++,o++)n[o]=i[a];return n}var r="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")(),i=o.Symbol,a=Object.prototype,c=a.hasOwnProperty,s=a.toString,u=i?i.toStringTag:void 0;var h=Object.prototype.toString;var l="[object Null]",p="[object Undefined]",f=i?i.toStringTag:void 0;function y(t){return null==t?void 0===t?p:l:f&&f in Object(t)?function(t){var e=c.call(t,u),r=t[u];try{t[u]=void 0;var n=!0}catch(t){}var o=s.call(t);return n&&(e?t[u]=r:delete t[u]),o}(t):function(t){return h.call(t)}(t)}function v(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var d="[object AsyncFunction]",_="[object Function]",g="[object GeneratorFunction]",b="[object Proxy]";function m(t){if(!v(t))return!1;var e=y(t);return e==_||e==g||e==d||e==b}var O,w=o["__core-js_shared__"],j=(O=/[^.]+$/.exec(w&&w.keys&&w.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"";var $=Function.prototype.toString;var S=/^\[object .+?Constructor\]$/,K=Function.prototype,z=Object.prototype,T=K.toString,A=z.hasOwnProperty,P=RegExp("^"+T.call(A).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function E(t){return!(!v(t)||(e=t,j&&j in e))&&(m(t)?P:S).test(function(t){if(null!=t){try{return $.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function k(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return E(r)?r:void 0}var x=function(){try{var t=k(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();function C(t,e){return t===e||t!=t&&e!=e}var F=Object.prototype.hasOwnProperty;function I(t,e,r){var n=t[e];F.call(t,e)&&C(n,r)&&(void 0!==r||e in t)||function(t,e,r){"__proto__"==e&&x?x(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}(t,e,r)}var M=Array.isArray;var D="[object Symbol]";function N(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&y(t)==D}var J=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,L=/^\w*$/;var R=k(Object,"create");var U="__lodash_hash_undefined__",G=Object.prototype.hasOwnProperty;var Q=Object.prototype.hasOwnProperty;var V="__lodash_hash_undefined__";function Y(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function q(t,e){for(var r=t.length;r--;)if(C(t[r][0],e))return r;return-1}Y.prototype.clear=function(){this.__data__=R?R(null):{},this.size=0},Y.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Y.prototype.get=function(t){var e=this.__data__;if(R){var r=e[t];return r===U?void 0:r}return G.call(e,t)?e[t]:void 0},Y.prototype.has=function(t){var e=this.__data__;return R?void 0!==e[t]:Q.call(e,t)},Y.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=R&&void 0===e?V:e,this};var B=Array.prototype.splice;function H(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}H.prototype.clear=function(){this.__data__=[],this.size=0},H.prototype.delete=function(t){var e=this.__data__,r=q(e,t);return!(r<0||(r==e.length-1?e.pop():B.call(e,r,1),--this.size,0))},H.prototype.get=function(t){var e=this.__data__,r=q(e,t);return r<0?void 0:e[r][1]},H.prototype.has=function(t){return q(this.__data__,t)>-1},H.prototype.set=function(t,e){var r=this.__data__,n=q(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var W=k(o,"Map");function X(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Z(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Z.prototype.clear=function(){this.size=0,this.__data__={hash:new Y,map:new(W||H),string:new Y}},Z.prototype.delete=function(t){var e=X(this,t).delete(t);return this.size-=e?1:0,e},Z.prototype.get=function(t){return X(this,t).get(t)},Z.prototype.has=function(t){return X(this,t).has(t)},Z.prototype.set=function(t,e){var r=X(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var tt="Expected a function";function et(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(tt);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=t.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(et.Cache||Z),r}et.Cache=Z;var rt=500;var nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/\\(\\)?/g,it=function(t){var e=et(t,function(t){return r.size===rt&&r.clear(),t}),r=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(nt,function(t,r,n,o){e.push(n?o.replace(ot,"$1"):r||t)}),e});var at=1/0,ct=i?i.prototype:void 0,st=ct?ct.toString:void 0;function ut(t){if("string"==typeof t)return t;if(M(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,ut)+"";if(N(t))return st?st.call(t):"";var e=t+"";return"0"==e&&1/t==-at?"-0":e}function ht(t,e){return M(t)?t:function(t,e){if(M(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!N(t))||L.test(t)||!J.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:it(function(t){return null==t?"":ut(t)}(t))}var lt=9007199254740991,pt=/^(?:0|[1-9]\d*)$/;function ft(t,e){var r=typeof t;return!!(e=null==e?lt:e)&&("number"==r||"symbol"!=r&&pt.test(t))&&t>-1&&t%1==0&&t<e}var yt,vt,dt=1/0;function _t(t){if("string"==typeof t||N(t))return t;var e=t+"";return"0"==e&&1/t==-dt?"-0":e}function gt(t,e,r){return null==t?t:function(t,e,r,n){if(!v(t))return t;for(var o=-1,i=(e=ht(e,t)).length,a=i-1,c=t;null!=c&&++o<i;){var s=_t(e[o]),u=r;if(o!=a){var h=c[s];void 0===(u=n?n(h,s,c):void 0)&&(u=v(h)?h:ft(e[o+1])?[]:{})}I(c,s,u),c=c[s]}return t}(t,e,r)}!function(t){t[t.localStorage=1]="localStorage",t[t.sessionStorage=2]="sessionStorage",t[t.memory=3]="memory"}(vt||(vt={}));var bt={},mt=((yt={})[vt.localStorage]=window.localStorage,yt[vt.sessionStorage]=window.sessionStorage,yt[vt.memory]={setItem:function(t,e){bt[t]=e},getItem:function(t){return bt[t]},removeItem:function(t){bt[t]=null,delete bt[t]}},yt),Ot=function(){function t(t,e){this.storage=t||mt[e]}return t.prototype.set=function(t,e){this.storage.setItem(t,JSON.stringify(e))},t.prototype.get=function(t){return JSON.parse(this.storage.getItem(t))},t.prototype.delete=function(t){return this.storage.removeItem(t)},t}(),wt=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.log.apply(console,e(["[cache-data]:"],t))},jt=function(){function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.storeType=vt.localStorage,this.init.apply(this,t)}return r.prototype.init=function(e,r,n){void 0===e&&(e=[]),void 0===r&&(r={}),void 0===n&&(n={}),this.formModel=e,this.$cacheOptions=n,Array.isArray(this.$cacheOptions)&&(this.$cacheOptions={cacheKeys:this.$cacheOptions||[]}),this.$cacheOptions=t(t({},r),this.$cacheOptions),this.isdebug=this.$cacheOptions.debug,this.cacheKeys=(this.$cacheOptions.cacheKeys||[]).map(function(t){var e={key:"",useLocalStore:!0};return"string"==typeof t?e.key=t:Object.assign(e,t),e}),this.namespace=this.$cacheOptions.namespace||"__TMQ_DEFAULT_KEY__",this.store=new Ot(null,this.storeType),this.applyData(),this.watchData()},r.prototype.getTruthKey=function(t){return""+this.namespace+t},r.prototype.applyData=function(){var t=this;this.cacheKeys.forEach(function(e){var r=e.key,n=t.store.get(t.getTruthKey(r));n&&(t.isdebug&&wt("setModel",r,n),gt(t.formModel,r,n))})},r.prototype.watchData=function(){var t=this;m(this.$cacheOptions.watcher)?this.watchs=this.cacheKeys.map(function(e){var r=e.key;return t.$cacheOptions.watcher(r,function(e){t.isdebug&&wt("watch",r,e),t.store.set(t.getTruthKey(r),e)})}):this.isdebug&&function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];console.warn.apply(console,e(["[cache-data]:"],t))}("\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a `options.watcher` \u7528\u6765\u63a5\u6536 `model` \u7684\u53d8\u5316, \u5426\u5219`model`\u7684\u53d8\u5316\u5c06\u4e0d\u4f1a\u88ab\u81ea\u52a8\u8bb0\u5f55")},r.prototype.destory=function(){this.watchs&&this.watchs.forEach(function(t){return t()})},r.prototype.deleteKey=function(t){this.store.delete(this.getTruthKey(t))},r.prototype.clear=function(t){var e=this;t?this.deleteKey(t):this.cacheKeys.map(function(t){var r=t.key;e.deleteKey(r)})},r}();return{VueCache:{install:function(e,r){void 0===r&&(r={}),r.optionKey=r.optionKey||"cache",e.mixin({mounted:function(){var e=this;this.$options[r.optionKey]&&(this.$model2cache=new jt(this,t(t({},r),{watcher:function(t,r){return e.$watch(t,r)}}),this.$options[r.optionKey]))},destroyed:function(){this.$options[r.optionKey]&&this.$model2cache.destory()}})}},Model2Cache:jt}});