/*!
 * Model2Cache.js v1.0.0
 * (c) 2019-2020 Teng Mao Qing
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Model2Cache={})}(this,function(t){"use strict";function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach(function(r){e(t,r,o[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}var o=Array.isArray,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},i="object"==typeof a&&a&&a.Object===Object&&a,c="object"==typeof self&&self&&self.Object===Object&&self,s=i||c||Function("return this")(),u=s.Symbol,h=Object.prototype,l=h.hasOwnProperty,f=h.toString,p=u?u.toStringTag:void 0;var v=function(t){var e=l.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=f.call(t);return n&&(e?t[p]=r:delete t[p]),o},y=Object.prototype.toString;var d=function(t){return y.call(t)},_="[object Null]",g="[object Undefined]",b=u?u.toStringTag:void 0;var O=function(t){return null==t?void 0===t?g:_:b&&b in Object(t)?v(t):d(t)};var m=function(t){return null!=t&&"object"==typeof t},j="[object Symbol]";var w=function(t){return"symbol"==typeof t||m(t)&&O(t)==j},$=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S=/^\w*$/;var D=function(t,e){if(o(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!w(t))||S.test(t)||!$.test(t)||null!=e&&t in Object(e)};var K=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},P="[object AsyncFunction]",M="[object Function]",C="[object GeneratorFunction]",z="[object Proxy]";var A,E=function(t){if(!K(t))return!1;var e=O(t);return e==M||e==C||e==P||e==z},k=s["__core-js_shared__"],L=(A=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"";var x=function(t){return!!L&&L in t},T=Function.prototype.toString;var F=function(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""},I=/^\[object .+?Constructor\]$/,N=Function.prototype,J=Object.prototype,R=N.toString,U=J.hasOwnProperty,G=RegExp("^"+R.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Q=function(t){return!(!K(t)||x(t))&&(E(t)?G:I).test(F(t))};var V=function(t,e){return null==t?void 0:t[e]};var Y=function(t,e){var r=V(t,e);return Q(r)?r:void 0},q=Y(Object,"create");var B=function(){this.__data__=q?q(null):{},this.size=0};var H=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},W="__lodash_hash_undefined__",X=Object.prototype.hasOwnProperty;var Z=function(t){var e=this.__data__;if(q){var r=e[t];return r===W?void 0:r}return X.call(e,t)?e[t]:void 0},tt=Object.prototype.hasOwnProperty;var et=function(t){var e=this.__data__;return q?void 0!==e[t]:tt.call(e,t)},rt="__lodash_hash_undefined__";var nt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=q&&void 0===e?rt:e,this};function ot(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}ot.prototype.clear=B,ot.prototype.delete=H,ot.prototype.get=Z,ot.prototype.has=et,ot.prototype.set=nt;var at=ot;var it=function(){this.__data__=[],this.size=0};var ct=function(t,e){return t===e||t!=t&&e!=e};var st=function(t,e){for(var r=t.length;r--;)if(ct(t[r][0],e))return r;return-1},ut=Array.prototype.splice;var ht=function(t){var e=this.__data__,r=st(e,t);return!(r<0||(r==e.length-1?e.pop():ut.call(e,r,1),--this.size,0))};var lt=function(t){var e=this.__data__,r=st(e,t);return r<0?void 0:e[r][1]};var ft=function(t){return st(this.__data__,t)>-1};var pt=function(t,e){var r=this.__data__,n=st(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function vt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}vt.prototype.clear=it,vt.prototype.delete=ht,vt.prototype.get=lt,vt.prototype.has=ft,vt.prototype.set=pt;var yt=vt,dt=Y(s,"Map");var _t=function(){this.size=0,this.__data__={hash:new at,map:new(dt||yt),string:new at}};var gt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var bt=function(t,e){var r=t.__data__;return gt(e)?r["string"==typeof e?"string":"hash"]:r.map};var Ot=function(t){var e=bt(this,t).delete(t);return this.size-=e?1:0,e};var mt=function(t){return bt(this,t).get(t)};var jt=function(t){return bt(this,t).has(t)};var wt=function(t,e){var r=bt(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function $t(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}$t.prototype.clear=_t,$t.prototype.delete=Ot,$t.prototype.get=mt,$t.prototype.has=jt,$t.prototype.set=wt;var St=$t,Dt="Expected a function";function Kt(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Dt);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=t.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(Kt.Cache||St),r}Kt.Cache=St;var Pt=Kt,Mt=500;var Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zt=/\\(\\)?/g,At=function(t){var e=Pt(t,function(t){return r.size===Mt&&r.clear(),t}),r=e.cache;return e}(function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Ct,function(t,r,n,o){e.push(n?o.replace(zt,"$1"):r||t)}),e});var Et=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},kt=1/0,Lt=u?u.prototype:void 0,xt=Lt?Lt.toString:void 0;var Tt=function t(e){if("string"==typeof e)return e;if(o(e))return Et(e,t)+"";if(w(e))return xt?xt.call(e):"";var r=e+"";return"0"==r&&1/e==-kt?"-0":r};var Ft=function(t){return null==t?"":Tt(t)};var It=function(t,e){return o(t)?t:D(t,e)?[t]:At(Ft(t))},Nt=1/0;var Jt=function(t){if("string"==typeof t||w(t))return t;var e=t+"";return"0"==e&&1/t==-Nt?"-0":e};var Rt=function(t,e){for(var r=0,n=(e=It(e,t)).length;null!=t&&r<n;)t=t[Jt(e[r++])];return r&&r==n?t:void 0};var Ut=function(t,e,r){var n=null==t?void 0:Rt(t,e);return void 0===n?r:n},Gt=function(){try{var t=Y(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var Qt=function(t,e,r){"__proto__"==e&&Gt?Gt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r},Vt=Object.prototype.hasOwnProperty;var Yt=function(t,e,r){var n=t[e];Vt.call(t,e)&&ct(n,r)&&(void 0!==r||e in t)||Qt(t,e,r)},qt=9007199254740991,Bt=/^(?:0|[1-9]\d*)$/;var Ht=function(t,e){var r=typeof t;return!!(e=null==e?qt:e)&&("number"==r||"symbol"!=r&&Bt.test(t))&&t>-1&&t%1==0&&t<e};var Wt=function(t,e,r,n){if(!K(t))return t;for(var o=-1,a=(e=It(e,t)).length,i=a-1,c=t;null!=c&&++o<a;){var s=Jt(e[o]),u=r;if(o!=i){var h=c[s];void 0===(u=n?n(h,s,c):void 0)&&(u=K(h)?h:Ht(e[o+1])?[]:{})}Yt(c,s,u),c=c[s]}return t};var Xt=function(t,e,r){return null==t?t:Wt(t,e,r)},Zt="[object String]";var te=function(t){return"string"==typeof t||!o(t)&&m(t)&&O(t)==Zt};const ee="__TMQ_DEFAULT_KEY__",re={},ne=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];console.log("[cache-data]:",...e)},oe=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];console.warn("[cache-data]:",...e)};class ae{constructor(){this.init(...arguments)}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.formModel=t,this.$cacheOptions=r,Array.isArray(this.$cacheOptions)&&(this.$cacheOptions={cacheKeys:this.$cacheOptions||[]}),this.$cacheOptions=n({},e,{},this.$cacheOptions),this.isdebug=this.$cacheOptions.debug,this.cacheKeys=(this.$cacheOptions.cacheKeys||[]).map(t=>{let e={key:"",useLocalStore:!0};return te(t)?e.key=t:Object.assign(e,t),e}),this.namespace=this.$cacheOptions.namespace||ee,this.MemCache=re,this.applyData(),this.watchData()}getKeyConfig(t){return this.cacheKeys.find(e=>e.key===t)||{}}getLocalData(t){const e=localStorage.getItem("".concat(this.namespace).concat(t));return e?JSON.parse(e):Ut(this.formModel,t)}getMemData(t){return this.MemCache[t]}getData(t){const{useLocalStore:e}=this.getKeyConfig(t);if(e)return this.getLocalData(t);this.getMemData(t)}setLocalDate(t,e){localStorage.setItem("".concat(this.namespace).concat(t),JSON.stringify(e))}setMemData(t,e){this.MemCache[t]=e}setData(t,e){const{useLocalStore:r}=this.getKeyConfig(t);r?this.setLocalDate(t,e):this.setMemData(t,e)}applyData(){this.cacheKeys.forEach(t=>{let{key:e}=t;const r=this.getData(e);this.isdebug&&ne("setModel",e,r),Xt(this.formModel,e,r)})}watchData(){E(this.$cacheOptions.watcher)?this.watchs=this.cacheKeys.map(t=>{let{key:e}=t;return this.$cacheOptions.watcher(e,t=>{this.isdebug&&ne("watch",e,t),this.setData(e,t)})}):this.isdebug&&oe("\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a `options.watcher` \u7528\u6765\u63a5\u6536 `model` \u7684\u53d8\u5316, \u5426\u5219`model`\u7684\u53d8\u5316\u5c06\u4e0d\u4f1a\u88ab\u81ea\u52a8\u8bb0\u5f55")}destory(){this.watchs&&this.watchs.forEach(t=>t())}deleteKey(t){const{useLocalStore:e}=this.getKeyConfig(t);e?localStorage.removeItem("".concat(this.namespace).concat(t)):this.MemCache[t]=null}clear(t){t?this.deleteKey(t):this.cacheKeys.map(t=>{let{key:e}=t;this.deleteKey(e)})}reset(){}}const ie={install(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.optionKey=e.optionKey||"cache",t.mixin({mounted(){this.$options[e.optionKey]&&(this.$model2cache=new ae(this,n({},e,{watcher:(t,e)=>this.$watch(t,e)}),this.$options[e.optionKey]))},destroyed(){this.$options[e.optionKey]&&this.$model2cache.destory()}})}};t.Model2Cache=ae,t.VueCache=ie,Object.defineProperty(t,"__esModule",{value:!0})});